<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì—¬í–‰ ê³„íš</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
    <div id="progress-container">
      <div id="progressBar" class="progress-bar"></div>
    </div>

    <div class="container">
      <div id="step1">
        <h2>ëŒ€í•œë¯¼êµ­</h2>
        <div class="location-buttons">
          <button class="btn" onclick="selectLocation('ì„œìš¸')">ì„œìš¸</button>
          <button class="btn" onclick="selectLocation('ê°€í‰Â·ì–‘í‰')">
            ê°€í‰Â·ì–‘í‰
          </button>
          <button class="btn" onclick="selectLocation('ê°•ë¦‰Â·ì†ì´ˆ')">
            ê°•ë¦‰Â·ì†ì´ˆ
          </button>
          <button class="btn" onclick="selectLocation('ê²½ì£¼')">ê²½ì£¼</button>
          <button class="btn" onclick="selectLocation('ë¶€ì‚°')">ë¶€ì‚°</button>
          <button class="btn" onclick="selectLocation('ì—¬ìˆ˜')">ì—¬ìˆ˜</button>
          <button class="btn" onclick="selectLocation('ì „ì£¼')">ì „ì£¼</button>
          <button class="btn" onclick="selectLocation('ì œì£¼')">ì œì£¼</button>
          <button class="btn" onclick="selectLocation('ì¶˜ì²œÂ·í™ì²œ')">
            ì¶˜ì²œÂ·í™ì²œ
          </button>
          <button class="btn" onclick="selectLocation('íƒœì•ˆ')">íƒœì•ˆ</button>
          <button class="btn" onclick="selectLocation('í†µì˜Â·ê±°ì œÂ·ë‚¨í•´')">
            í†µì˜Â·ê±°ì œÂ·ë‚¨í•´
          </button>
          <button class="btn" onclick="selectLocation('í¬í•­Â·ì•ˆë™')">
            í¬í•­Â·ì•ˆë™
          </button>
        </div>
        <button class="next-btn" id="nextStep1" onclick="goToStep2()" disabled>
          ë‹¤ìŒ
        </button>
      </div>

      <!-- ë™ë°˜ì ì„ íƒ í™”ë©´ -->
      <div id="step2" class="hidden">
        <button class="back-btn" onclick="goToStep1()">ì´ì „</button>
        <!-- <div class="emoji">ğŸ˜</div> -->
        <h2>ëˆ„êµ¬ì™€ ë– ë‚˜ë‚˜ìš”?</h2>
        <p>ë‹¤ì¤‘ ì„ íƒì´ ê°€ëŠ¥í•´ìš”.</p>
        <div class="location-buttons">
          <button class="btn" onclick="selectedCompanion('í˜¼ì')">í˜¼ì</button>
          <button class="btn" onclick="selectedCompanion('ì¹œêµ¬ì™€')">
            ì¹œêµ¬ì™€
          </button>
          <button class="btn" onclick="selectedCompanion('ì—°ì¸ê³¼')">
            ì—°ì¸ê³¼
          </button>
          <button class="btn" onclick="selectedCompanion('ë°°ìš°ìì™€')">
            ë°°ìš°ìì™€
          </button>
          <button class="btn" onclick="selectedCompanion('ì•„ì´ì™€')">
            ì•„ì´ì™€
          </button>
          <button class="btn" onclick="selectedCompanion('ë¶€ëª¨ë‹˜ê³¼')">
            ë¶€ëª¨ë‹˜ê³¼
          </button>
          <button class="btn" onclick="selectedCompanion('ì• ì™„ë™ë¬¼')">
            ì• ì™„ë™ë¬¼
          </button>
        </div>
        <button class="next-btn" id="nextStep2" onclick="goToStep3()" disabled>
          ë‹¤ìŒ
        </button>
      </div>

      <!-- ì—¬í–‰ ê¸°ê°„ ì„ íƒ í™”ë©´ -->
      <div id="step3" class="hidden">
        <button class="back-btn" onclick="goToStep2FromStep3()">ì´ì „</button>
        <h2>ì—¬í–‰ ê¸°ê°„ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?</h2>
        <div class="location-buttons">
          <button class="btn" onclick="selectDuration('1ì¼')">ë‹¹ì¼ì¹˜ê¸°</button>
          <button class="btn" onclick="selectDuration('1ë°• 2ì¼')">
            1ë°• 2ì¼
          </button>
          <button class="btn" onclick="selectDuration('2ë°• 3ì¼')">
            2ë°• 3ì¼
          </button>
          <button class="btn" onclick="selectDuration('3ë°• 4ì¼')">
            3ë°• 4ì¼
          </button>
          <button class="btn" onclick="selectDuration('4ë°• 5ì¼')">
            4ë°• 5ì¼
          </button>
          <button class="btn" onclick="selectDuration('5ë°• 6ì¼')">
            5ë°• 6ì¼
          </button>
        </div>
        <button class="next-btn" id="nextStep3" onclick="goToStep4()" disabled>
          ë‹¤ìŒ
        </button>
      </div>

      <!-- ì—¬í–‰ ìŠ¤íƒ€ì¼-->
      <div id="step4" class="hidden">
        <button class="back-btn" onclick="goToStep3FromStep4()">ì´ì „</button>
        <h2>ì–´ë–¤ ì—¬í–‰ ìŠ¤íƒ€ì¼ì„ ì„ í˜¸í•˜ì‹œë‚˜ìš”?</h2>
        <div class="location-buttons">
          <button class="btn" onclick="selectStyle('ì²´í—˜Â·ì•¡í‹°ë¹„í‹°')">
            ì²´í—˜Â·ì•¡í‹°ë¹„í‹°
          </button>
          <button class="btn" onclick="selectStyle('ìì—°ê³¼ í•¨ê»˜')">
            ìì—°ê³¼ í•¨ê»˜
          </button>
          <button
            class="btn"
            onclick="selectStyle('í•´ë‹¹ ì§€ì—­ì˜ ìœ ëª… ê´€ê´‘ì§€ë¥¼ í•„ìˆ˜ë¡œ í•´')"
          >
            ìœ ëª… ê´€ê´‘ì§€ í•„ìˆ˜
          </button>
          <button
            class="btn"
            onclick="selectStyle('íë§ì„ í•˜ë©° ë§ˆìŒì˜ ì•ˆì •ì„ ì–»ì„ ìˆ˜ ìˆëŠ” ì¥ì†Œë¥¼ í¬í•¨í•´')"
          >
            íë§ì„ ëŠë¼ëŠ”
          </button>
          <button class="btn" onclick="selectStyle('ì—¬í–‰ì§€ ëŠë‚Œì„ ë°›ì•„ì•¼í•´')">
            ì—¬í–‰ì§€ ëŠë‚Œì„ ë°›ëŠ”
          </button>
          <button class="btn" onclick="selectStyle('ì‡¼í•‘ì„ ìš°ì„ ìœ¼ë¡œ í•´')">
            ì‡¼í•‘ì„ ìš°ì„ ìœ¼ë¡œ í•˜ëŠ”
          </button>
          <button
            class="btn"
            onclick="selectStyle('ê´€ê´‘ ë³´ë‹¤ëŠ” í•´ë‹¹ ì§€ì—­ì˜ ëŒ€í‘œ ë§›ì§‘ì„ í¬í•¨í•´')"
          >
            ê´€ê´‘ ë³´ë‹¤ëŠ” ë§›ì§‘
          </button>
          <button class="btn" onclick="selectStyle('SNS í•«í”Œë ˆì´ìŠ¤ë¥¼ ê°€ì•¼í•´')">
            SNS í•«í”Œë ˆì´ìŠ¤
          </button>
          <button
            class="btn"
            onclick="selectStyle('ë¬¸í™”Â·ì˜ˆìˆ Â·ì—­ì‚¬ ì²´í—˜í•  ìˆ˜ ìˆëŠ” ì¥ì†Œë¥¼ í¬í•¨')"
          >
            ë¬¸í™”Â·ì˜ˆìˆ Â·ì—­ì‚¬
          </button>
        </div>
        <button class="next-btn" id="nextStep4" onclick="goToStep5()">
          ë‹¤ìŒ
        </button>
      </div>

      <!-- ì—¬í–‰ ì¼ì •-->
      <div id="step5" class="hidden">
        <button class="back-btn" onclick="goToStep4FromStep5()">ì´ì „</button>
        <h2>ì–´ëŠ ì •ë„ì˜ ì¼ì •ì„ ì„ í˜¸í•˜ì‹œë‚˜ìš”?</h2>
        <div class="location-buttons">
          <button class="btn" onclick="selectSchedule('ë¹¼ê³¡í•œ ì¼ì • ì„ í˜¸')">
            ë¹¼ê³¡í•œ ì¼ì • ì„ í˜¸
          </button>
          <button class="btn" onclick="selectSchedule('ë„ë„í•œ ì¼ì • ì„ í˜¸')">
            ë„ë„í•œ ì¼ì • ì„ í˜¸
          </button>
        </div>
        <button class="next-btn" id="nextStep5" onclick="showSelection()">
          ê²°ê³¼ë³´ê¸°
        </button>
      </div>
    </div>

    <!-- ì œë¯¸ë‚˜ì´ ë‹µë³€ ì¶œë ¥
    <div id="result" class="hidden">
      <h3>ì—¬í–‰ ê³„íš ê²°ê³¼</h3>
      <div id="resultText"></div>
    </div> -->

    <!-- ì—¬í–‰ ê³„íš ê²°ê³¼ í™”ë©´ -->
    <div id="step6" class="hidden">
      <button class="back-btn" onclick="goToStep1FromStep6()">ë‹¤ì‹œí•˜ê¸°</button>
      <h2>ì—¬í–‰ ê³„íš ê²°ê³¼</h2>
      <div id="resultText"></div>
    </div>

    <script>
      let selectedLocation = ""; //ì§€ì—­ì„ íƒ
      let selectedCompanions = []; //ë™ë°˜ì
      let selectedDuration = ""; //ê¸°ê°„
      let selectedStyle = []; //ì—¬í–‰ ìŠ¤íƒ€ì¼
      let selectedSchedule = ""; //ì—¬í–‰ ì¼ì • ì •ë„

      let currentStep = 0;
      const totalSteps = 4; // ì´ ë‹¨ê³„ ìˆ˜
      let progressWidth = 0;

      // í”„ë¡œê·¸ë ˆìŠ¤ ë°”ë¥¼ ì„œì„œíˆ ì°¨ì˜¤ë¥´ê²Œ í•˜ëŠ” í•¨ìˆ˜
      function increaseProgressBar() {
        const progressBar = document.getElementById("progressBar");
        const interval = setInterval(function () {
          if (progressWidth >= (currentStep / totalSteps) * 100) {
            clearInterval(interval); // ëª©í‘œê°’ì— ë„ë‹¬í•˜ë©´ ë©ˆì¶”ê¸°
          } else {
            progressWidth += 1; // 1ì”© ì¦ê°€
            progressBar.style.width = `${progressWidth}%`;
          }
        }, 10); // 10msë§ˆë‹¤ ì¦ê°€
      }

      // í”„ë¡œê·¸ë ˆìŠ¤ ë°” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
      function updateProgressBar() {
        const progress = (currentStep / totalSteps) * 100; // í˜„ì¬ ë‹¨ê³„ì— ëŒ€í•œ ë¹„ìœ¨ ê³„ì‚°
        document.getElementById("progressBar").style.width = `${progress}%`;
      }

      function deleteProgressBar() {
        const progressBar = document.getElementById("progressBar");
        progressBar.style.width = "100%"; // ë¨¼ì € 100%ë¡œ ì±„ìš°ê³ 
        setTimeout(function () {
          const interval = setInterval(function () {
            if (progressBar.style.width === "0%") {
              clearInterval(interval); // ëª©í‘œê°’ì— ë„ë‹¬í•˜ë©´ ë©ˆì¶”ê¸°
            } else {
              let currentWidth = parseInt(progressBar.style.width);
              progressBar.style.width = `${currentWidth - 1}%`; // 1%ì”© ì¤„ì–´ë“¦
            }
          }, 50); // 10msë§ˆë‹¤ ê°ì†Œ
        }, 1000); // 1ì´ˆ í›„ì— í”„ë¡œê·¸ë ˆìŠ¤ ë°”ê°€ ì‚¬ë¼ì§€ê¸° ì‹œì‘
      }

      //1ë‹¨ê³„ ì—¬í–‰ì§€ ì„ íƒ ë³€ìˆ˜ ì €ì¥
      function selectLocation(location) {
        selectedLocation = location;
        document
          .querySelectorAll("#step1 .btn")
          .forEach((btn) => btn.classList.remove("selected"));
        event.target.classList.add("selected");
        document.getElementById("nextStep1").disabled = false;
      }

      //2ë‹¨ê³„ë¡œ ê°€ê¸° - ë™ë°˜ì ì„ íƒ
      function goToStep2() {
        if (selectedLocation) {
          document.getElementById("step1").classList.add("hidden");
          document.getElementById("step2").classList.remove("hidden");
          currentStep = 1;
          updateProgressBar();
        }
      }

      //1ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸° - ì—¬í–‰ì§€ ì„ íƒìœ¼ë¡œ
      function goToStep1() {
        document.getElementById("step2").classList.add("hidden");
        document.getElementById("step1").classList.remove("hidden");
        currentStep = 0;
        updateProgressBar();
      }

      //2ë‹¨ê³„ - ë™ë°˜ì ë³€ìˆ˜ë¥¼ ë°°ì—´ë¡œ ì¤‘ë³µ ì €ì¥
      function selectedCompanion(companion) {
        const index = selectedCompanions.indexOf(companion);
        if (index > -1) {
          selectedCompanions.splice(index, 1);
          event.target.classList.remove("selected");
        } else {
          selectedCompanions.push(companion);
          event.target.classList.add("selected");
        }
        document.getElementById("nextStep2").disabled =
          selectedCompanions.length === 0;
      }

      //3ë‹¨ê³„ë¡œ ì´ë™ê°€ê¸°
      function goToStep3() {
        if (selectedCompanions.length > 0) {
          document.getElementById("step2").classList.add("hidden");
          document.getElementById("step3").classList.remove("hidden");
          currentStep = 2;
          updateProgressBar();
        }
      }

      //2ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸°
      function goToStep2FromStep3() {
        document.getElementById("step3").classList.add("hidden");
        document.getElementById("step2").classList.remove("hidden");
        currentStep = 1;
        updateProgressBar();
      }

      //3ë‹¨ê³„ - ê¸°ê°„ì„ ì •í•˜ê¸°
      function selectDuration(duration) {
        selectedDuration = duration;
        document
          .querySelectorAll("#step3 .btn")
          .forEach((btn) => btn.classList.remove("selected"));
        event.target.classList.add("selected");
        document.getElementById("nextStep3").disabled = false;
      }

      //4ë‹¨ê³„ë¡œ ì´ë™
      function goToStep4() {
        if (selectedDuration) {
          document.getElementById("step3").classList.add("hidden");
          document.getElementById("step4").classList.remove("hidden");
          currentStep = 3;
          updateProgressBar();
        }
      }

      //3ë‹¨ê³„ë¡œ ëŒì•„ì˜¤ê¸°
      function goToStep3FromStep4() {
        document.getElementById("step4").classList.add("hidden");
        document.getElementById("step3").classList.remove("hidden");
        currentStep = 2;
        updateProgressBar();
      }

      // 4ë‹¨ê³„ - ì—¬í–‰ ìŠ¤íƒ€ì¼ ì„ íƒ í•¨ìˆ˜ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)
      function selectStyle(style) {
        const index = selectedStyle.indexOf(style);
        if (index > -1) {
          selectedStyle.splice(index, 1);
          event.target.classList.remove("selected");
        } else {
          selectedStyle.push(style);
          event.target.classList.add("selected");
        }
        document.getElementById("nextStep4").disabled =
          selectedStyle.length === 0;
      }

      // 5ë‹¨ê³„ë¡œ ì´ë™
      function goToStep5() {
        if (selectedStyle.length > 0) {
          document.getElementById("step4").classList.add("hidden");
          document.getElementById("step5").classList.remove("hidden");
          currentStep = 4;
          updateProgressBar();
        }
      }

      // 4ë‹¨ê³„ë¡œ ì´ë™
      function goToStep4FromStep5() {
        document.getElementById("step5").classList.add("hidden");
        document.getElementById("step4").classList.remove("hidden");
        currentStep = 3;
        updateProgressBar();
      }

      // 5ë‹¨ê³„ - ì—¬í–‰ ì¼ì • ì„ íƒ í•¨ìˆ˜
      function selectSchedule(schedule) {
        selectedSchedule = schedule;
        document
          .querySelectorAll("#step5 .btn")
          .forEach((btn) => btn.classList.remove("selected"));
        event.target.classList.add("selected");
      }

      // 6ë‹¨ê³„ì—ì„œ 1ë‹¨ê³„ë¡œ ëŒì•„ê°€ê¸°
      function goToStep1FromStep6() {
        document.getElementById("step6").classList.add("hidden");
        document.getElementById("step1").classList.remove("hidden");
        document
          .getElementById("progress-container")
          .classList.remove("hidden");
        currentStep = 0;
        updateProgressBar();
      }

      async function callGeminiAPI() {
        const response = await fetch(
          "https://productive-majestic-olivine.glitch.me/1",
          {
            method: "POST",
            body: JSON.stringify({
              text: `ë„ˆëŠ” ì—¬í–‰ ê³„íš ì „ë¬¸ê°€ì•¼. ë‚˜ëŠ” ì§€ê¸ˆ ì—¬í–‰ì„ ê°€ê³  ì‹¶ì€ë°, ë‹¤ìŒê³¼ ê°™ì€ ì¡°ê±´ë“¤ì´ ìˆì–´:
                    1. ì—¬í–‰ì§€ëŠ” ${selectedLocation}ë¡œ ì •í–ˆì–´.
                    2. ë™ë°˜ìëŠ” ${selectedCompanions.join(", ")}ì™€ í•¨ê»˜ ê°ˆ ê±°ì•¼.
                    3. ì—¬í–‰ ê¸°ê°„ì€ ${selectedDuration}ë¡œ ê³„íší•˜ê³  ìˆì–´.
                    4. ë‚´ê°€ ì„ í˜¸í•˜ëŠ” ì—¬í–‰ ìŠ¤íƒ€ì¼ì€ ${selectedStyle.join(
                      ", "
                    )}ì•¼.
                    5. ì—¬í–‰ ì¼ì •ì€ ${selectedSchedule} ì •ë„ë¡œ í•˜ê³  ì‹¶ì–´.
                    ì´ ì¡°ê±´ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ì—¬í–‰ ì¼ì •ì„ Day 1, Day 2 ì‹ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì¶”ì²œí•´ì£¼ê³  ì ˆëŒ€ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ ë³´ì—¬ì£¼ì§€ë§ˆ.`,
            }),
            headers: {
              "Content-Type": "application/json",
            },
          }
        );
        const json = await response.json();
        return json.reply;
      }

      // 5ë‹¨ê³„ì—ì„œ ê²°ê³¼ë³´ê¸°
      function showSelection() {
        deleteProgressBar();
        callGeminiAPI().then((reply) => {
          const resultText = document.getElementById("resultText");

          resultText.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”
          const lines = reply.split("\n"); // ì¤„ë°”ê¿ˆ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° ë¶„ë¦¬

          let currentDay = "";
          lines.forEach((line) => {
            if (line.startsWith("Day")) {
              currentDay = document.createElement("div");
              currentDay.classList.add("day-title");
              currentDay.textContent = line;
              resultText.appendChild(currentDay);
            } else {
              const p = document.createElement("p");
              p.textContent = line;
              resultText.appendChild(p);
            }
          });

          // ê²°ê³¼ í™”ë©´ìœ¼ë¡œ ì´ë™
          document.getElementById("progress-container").classList.add("hidden");
          document.getElementById("step5").classList.add("hidden");
          document.getElementById("step6").classList.remove("hidden");
        });
      }
    </script>
  </body>
</html>
